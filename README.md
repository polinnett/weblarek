# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn dev
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Интернет-магазин «Web-Larёk»

«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component

Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`

#### Класс Api

Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter

Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` - хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

#### Данные

В проекте используются 2 основные сущности данных — товар, доступный для покупки, и покупатель, совершающий заказ.
Для описания этих сущностей используются следующие интерфейсы:

#### Интерфейс товара

`interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
}`

Интерфейс описывает структуру любого товара, который отображается в каталоге и может быть добавлен в корзину.

#### Интерфейс покупателя

`interface IBuyer {
    payment: TPayment;
    email: string;
    phone: string;
    address: string;
}`

Где: `type TPayment = 'online' | 'cash' | '';`

Интерфейс определяет данные покупателя, необходимые для оформления заказа.

#### Модели данных

Модели данных — это классы, которые отвечают за хранение и обработку данных.
В проекте используются три модели: Каталог товаров, Корзина, Покупатель.

Каждая модель имеет собственную зону ответственности и набор методов.

#### Catalog (Каталог товаров)

Модель отвечает за хранение всего списка товаров, а также товара, который выбран пользователем для детального просмотра. Она обеспечивает доступ к данным каталога и поиск нужного элемента.

Конструктор класса не принимает параметров.

Поля класса:
`products: IProduct[]` – хранит массив всех товаров, доступных в каталоге.
`selectedProduct: IProduct | null` – хранит товар, который пользователь выбрал для подробного просмотра.

Методы класса:
`setProducts(products: IProduct[]): void` – принимает массив товаров и сохраняет его внутрь модели.
`getProducts(): IProduct[]` – получение массива товаров из модели.
`getProductById(id: string): IProduct | undefined` – получение одного товара по его id.
`setSelectedProduct(product: IProduct): void` – сохранение товара для подробного отображения.
`getSelectedProduct(): IProduct | null` – получение товара для подробного отображения.

#### Cart (Корзина)

Модель корзины отвечает за хранение товаров, которые пользователь добавил для покупки. Она предоставляет методы для изменения содержимого корзины и вычисления итоговых значений.

Конструктор класса не принимает параметров.

Поля класса:
`items: IProduct[]` – хранит массив товаров, выбранных покупателем для покупки.

Методы класса:
`getItems(): IProduct[]` – получение массива товаров, которые находятся в корзине.
`addItem(product: IProduct): void` – добавление товара, который был получен в параметре, в массив корзины.
`removeItem(product: IProduct): void` – удаление товара, полученного в параметре из массива корзины.
`clear(): void` – очищает всю корзину.
`getTotal(): number` – получение стоимости всех товаров в корзине.
`getCount(): number` – получение количества товаров в корзине.
`hasItem(id: string): boolean` – проверка наличия товара в корзине по его id, полученного в параметр метода.

#### Buyer (Покупатель)

Модель покупателя хранит данные, которые пользователь вводит при оформлении заказа: способ оплаты, адрес, телефон и email. Класс позволяет изменять данные по отдельности, валидировать их и полностью очищать.

Конструктор класса не принимает параметров.

Поля класса:
`payment: TPayment` – вид оплаты.
`address: string` – адрес.
`phone: string` – телефон.
`email: string` – email.

Методы класса:
`setField<K extends keyof IBuyer>(field: K, value: IBuyer[K]): void` – универсальный метод, позволяющий изменить только одно поле без затрагивания остальных.
`getData(): IBuyer` – получение всех данных покупателя.
`clear(): void` – очистка данных покупателя.
`validate(): Partial<Record<keyof IBuyer, string>>` – проверяет корректность значений.
Возвращает объект, где: ключ — имя поля с ошибкой, а значение — текст ошибки. Если поле корректно, то оно не попадает в результирующий объект.

Пример результата:
`{
    payment: 'Не выбран вид оплаты',
    email: 'Укажите email',
}`

#### Слой коммуникации

Класс ApiClient отвечает за взаимодействие с сервером.

Конструктор: `constructor(api: IApi)` - принимает объект, реализующий интерфейс IApi.

Методы класса:
`getProductList(): Promise<IProduct[]>` - выполняет GET-запрос к эндпоинту /product и возвращает массив товаров
`createOrder(orderData: IOrderData): Promise<IOrderResult>`- выполняет POST-запрос к эндпоинту /order и отправляет данные заказа

### Слой предстваления

#### Header

Компонент отвечает за отображение шапки сайта: счетчика корзины и кнопки открытия корзины.

Конструктор: `constructor(events: IEvents, container: HTMLElement)`

Поля класса:
`counterElement: HTMLElement` – DOM-элемент, отображающий количество товаров.
`basketButton: HTMLButtonElement` – кнопка открытия корзины.
`events: IEvents` – объект событийной модели.

Методы класса:
`set counter(value: number): void` – отрисовывает количество товаров в корзине.

Генерируемые события:
`basket:open` – при клике на кнопку корзины.

#### Gallery (каталог товаров)

Компонент отвечает за отображение списка карточек каталога на главной странице.

Конструктор: `constructor(container: HTMLElement)`

Поля:
`catalogElement: HTMLElement` – контейнер, в который выводятся карточки товаров.

Методы:
`set catalog(items: HTMLElement[]): void` – заменяет содержимое каталога на переданный массив DOM-элементов.

#### Card<T> (абстрактная карточка товара)

Родительский класс для всех типов карточек. Содержит общий для карточек функционал: работу с заголовком, ценой и кнопкой.

Конструктор: `constructor(container: HTMLElement, actions?: ICardActions)`

Поля:
`titleElement: HTMLElement` – элемент, отображающий название товара.
`priceElement: HTMLElement` – элемент, отображающий цену товара.
`buttonElement?: HTMLButtonElement` – кнопка карточки (если есть).
`actions?: ICardActions` – объект обработчиков событий.

Методы:
`set title(value: string): void` – устанавливает название товара.
`set price(value: number | null): void` — сохраняет числовое значение цены. Форматирование текста ("синапсов", "Бесценно", "Недоступно") выполняют дочерние классы.
`set buttonTitle(value: string): void` – изменяет текст кнопки.
`set buttonDisabled(flag: boolean): void` – включает/отключает кнопку.
`render(data: Partial<T>): HTMLElement` – обновляет карточку через сеттеры и возвращает DOM-элемент. Используется для рендеринга во всех местах отображения.

Генерируемые события (через actions, вызываются презентером):
`card:select` – при клике по карточке.
`card:buy` – при клике по кнопке «Купить».
`card:remove`– при клике по кнопке удаления товара.

#### CardCatalog (карточка в каталоге)

Компонент отображает товар в общем каталоге.

Конструктор: `constructor(container: HTMLElement, actions?: ICardActions)`

Поля:
`categoryElement: HTMLElement` – DOM-элемент для отображения категории товара.
`imageElement: HTMLImageElement` – изображение товара.

Методы:
`set category(value: string): void` – устанавливает категорию товара и соответствующие CSS-классы.
`set image(value: string): void` – устанавливает изображение товара в карточке каталога.
`set price(value: number | null): void` — устанавливает цену и добавляет текст "синапсов" (переопределяет метод родителя).

Генерируемые события (через actions, вызываются презентером): `card:select` – по клику на карточку.

#### CardPreview (карточка товара в модальном окне)

Компонент отображает подробную информацию о товаре.

Конструктор: `constructor(container: HTMLElement, actions?: ICardActions)`

Поля:
`categoryElement: HTMLElement` – DOM-элемент для отображения категории товара.
`imageElement: HTMLImageElement` – изображение товара.
`descriptionElement: HTMLElement` – описание товара.

Методы:
`set category(value: string): void` – устанавливает категорию товара и соответствующие CSS-классы.
`set image(value: string): void` – устанавливает изображение товара в модальном окне.
`set description(value: string): void` – устанавливает описание товара.
`set inBasket(flag: boolean): void` – меняет состояние кнопки («Купить» / «Удалить из корзины»).
`set price(value: number | null): void` — устанавливает цену и добавляет текст "синапсов" (переопределяет метод родителя).

Генерируемые события (через actions, вызываются презентером):
`card:buy` – при клике по кнопке «Купить» в модальном окне.
`card:remove`– при клике по кнопке «Удалить из корзины» в модальном окне.

#### CardBasket (карточка товара в корзине)

Компонент отображает товар внутри корзины.

Конструктор: `constructor(container: HTMLElement, actions?: ICardActions)`

Поля:
`deleteButton: HTMLButtonElement` – кнопка удаления товара из корзины.

Методы: наследуется от родителя Card<T>.

Генерируемые события (через actions, вызываются презентером):
`basket:remove` – по клику на кнопку удаления.

#### Modal

Компонент отвечает за универсальное модальное окно, в котором отображаются другие компоненты. От него нельзя наследоваться.

Конструктор: `constructor(events: IEvents, container: HTMLElement)`

Поля:
`contentElement: HTMLElement` – область, в которую помещается контент модального окна.
`closeButton: HTMLButtonElement` – кнопка закрытия модального окна.
`events: IEvents` – объект событийной модели.

Методы:
`open(content: HTMLElement): void` – открывает модальное окно с указанным контентом.
`close(): void` – закрывает модальное окно.

Генерируемые события (через events):
`modal:close` – при клике на крестик или на фон.

#### Form<T> (абстрактная форма)

Родительский компонент для всех форм оформления заказа.

Конструктор: `constructor(events: IEvents, container: HTMLElement)`

Поля:
`submitButton: HTMLButtonElement` – кнопка отправки формы.
`errorElement: HTMLElement`– DOM-элемент для отображения ошибок.
`events: IEvents` – объект событийной модели.

Методы:
`set valid(flag: boolean): void` – включает или отключает кнопку отправки.
`set errors(list: string[]): void` – отображает список ошибок.
`serialize(): T` – собирает и возвращает данные формы.

События (через events):
`form:submit` – отправка формы.
`form:change` – при изменении любого поля.

#### FormOrder (форма выбора оплаты и адреса)

Первый шаг оформления заказа — выбор способа оплаты и ввод адреса доставки.

Конструктор: `constructor(events: IEvents, container: HTMLElement)`

Поля:
`paymentElement: HTMLElement` – группа элементов для выбора способа оплаты.
`addressElement: HTMLInputElement` – поле для ввода адреса доставки.

Методы:
`set payment(value: string): void` – устанавливает выбранный способ оплаты в DOM.
`set address(value: string): void` – устанавливает значение поля адреса.

Генерируемые события (через events):
`order:next` – при нажатии кнопки «Далее» после успешной валидации.

#### FormContacts (форма с контактами)

Второй шаг оформления заказа – ввод контактных данных покупателя.

Конструктор: `constructor(events: IEvents, container: HTMLElement)`

Поля:
`emailElement: HTMLInputElement` — поле для ввода email-адреса.
`phoneElement: HTMLInputElement` — поле для ввода номера телефона.

Методы:
`set email(value: string): void` — устанавливает значение email в соответствующее поле ввода.
`set phone(value: string): void` — устанавливает номер телефона в DOM.

Генерируемые события (через events):
`order:submit` — при нажатии кнопки «Оплатить», если форма успешно прошла валидацию.

#### Basket

Компонент отображает товары корзины и итоговую сумму.

Конструктор: `constructor(events: IEvents, container: HTMLElement)`

Поля:
`listElement: HTMLElement` – контейнер списка товаров.
`totalElement: HTMLElement` – отображает итоговую сумму.
`buttonElement: HTMLButtonElement` – кнопка оформления заказа.
`events: IEvents` – объект событийной модели.

Методы:
`set items(value: HTMLElement[]): void` – отрисовывает товары.
`set total(value: number): void` – устанавливает итоговую цену.
`set empty(flag: boolean): void` – переключает сообщение «Корзина пуста».

Генерируемые события (через events):
`basket:checkout` – при нажатии на кнопку «Оформить».

#### Success (сообщение об успешной оплате)

Компонент отображает сообщение о завершении покупки.

Конструктор: `constructor(events: IEvents, container: HTMLElement)`

Поля:
`descriptionElement: HTMLElement` – текст с суммой списанных синапсов.  
`buttonElement: HTMLButtonElement` – кнопка «За новыми покупками!».  
`events: IEvents` – объект событийной модели.

Методы:
`set total(value: number): void` – подставляет итоговую сумму в текст сообщения.

Генерируемые события (через events):
`success:close` – по клику на кнопку «За новыми покупками!».

### События

#### Header

`basket:open` – по клику на кнопку корзины. Назначение: открыть корзину.

#### Card

`card:select`(CardCatalog) – при клике по карточке в каталоге. Назначение: открыть модальное окно с полной информацией о товаре.
Данные: `{ id: string }` — идентификатор товара.
`card:buy`(CardPreview) – при клике на кнопку «Купить». Назначение: добавить товар в корзину
Данные: `{ id: string }`
`card:remove` – CardPreview — по кнопке «Удалить из корзины». CardBasket — по кнопке удаления товара в корзине. Назначение: удалить товар из корзины
Данные: { id: string }

#### Modal

`modal:close` – клик на фон, клик на крестик. Назначение: закрыть модальное окно и сбросить состояние preview (не обрабатывается презентером, тк логика закрытия не требует доп действий).

#### Form

`form:change` (Form (родитель всех форм)) – при любом изменении поля формы. Назначение: обновить отображение ошибок, включить/выключить кнопку отправки, обновить состояние модели покупателя.
`form:submit` (Form) – отправляется HTML-форма (submit). Назначение: промежуточное событие, которое обрабатывают FormOrder или FormContacts.
`order:next` (FormOrder) – по сабмиту первой формы, если валидация успешна. Назначение: открыть второй шаг — форму контактов.
`order:submit` (FormContacts) – по клику на кнопку «Оплатить». Назначение: отправить заказ на сервер.

#### Basket

`basket:checkout` – по клику на кнопку «Оформить». Назначение: открыть форму оформления заказа (первый шаг)

#### Success

`success:close` – по клику на кнопку «За новыми покупками!». Назначение: закрыть модалку, очистить корзину, вернуться на главную страницу.

### Презентер

Презентер реализован в файле main.ts и представляет собой центральный слой приложения, который получает события от Представления (View) и Моделей данных (Model), и координирует их взаимодействие. Отдельный класс презентера не создается, так как приложение одностраничное, и один презентер в main.ts полностью покрывает необходимую логику.

#### Основные обязанности презентера

1. Создание всех основных модулей приложения: брокера событий EventEmitter, API-клиента, моделей Catalog, Cart, Buyer, компонентов представления: Header, Gallery, карточки, формы, корзины, модальных окон.
2. Презентер обрабатывает события, которые генерируются при изменении данных:
   `catalog:changed` — при загрузке списка товаров.
   `catalog:select` — при выборе товара для просмотра.
   `cart:changed` — при изменении содержимого корзины.
3. Презентер обрабатывает все пользовательские действия:
   выбор карточки: `card:select`.
   покупка товара: `card:buy`.
   удаление товара: `card:remove`
   открытие корзины: `basket:open`.
   переход к оформлению: `basket:checkout`.
   изменение полей формы: `form:change`.
   переход к шагу оплаты: `order:next`.
   завершение оформления заказа: `order:submit`.
   закрытие окна успеха: `success:close`.
4. Презентер вызывает рендер компонентов только в двух ситуациях: после изменения данных в модели (изменение корзины и тд) или при открытии модального окна (предпросмотр товара, открытие корзины и тд).
